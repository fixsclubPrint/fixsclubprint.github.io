<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>Bahu e-EPIC Professional Generator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #d1d9e0; padding: 20px; }
        .form-container { background: #fff; max-width: 950px; margin: 0 auto; padding: 20px; border-radius: 12px; border: 2px solid #1a237e; }
        .row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 15px; }
        .form-group { display: flex; flex-direction: column; }
        label { font-size: 11px; font-weight: bold; margin-bottom: 5px; color: #1a237e; }
        input { padding: 8px; border: 1px solid #ccc; border-radius: 5px; outline: none; }

        #print-area { display: none; margin-top: 30px; flex-direction: column; align-items: center; gap: 25px; }
        
        /* THE BOX DESIGN */
        .voter-box { 
            width: 325px; height: 205px; 
            background: #fff; 
            border: 1px solid #000; 
            position: relative; overflow: hidden;
            background-image: url('https://www.transparenttextures.com/patterns/white-diamond.png');
        }

        /* Front Header */
        .v-header { display: flex; align-items: center; border-bottom: 1.2px solid #000; padding: 4px 10px; background: #fff; }
        .v-header img { height: 26px; }
        .v-header-text { text-align: center; flex-grow: 1; line-height: 1.1; }
        .v-header-text div:first-child { font-size: 11px; font-weight: 900; }
        .v-header-text div:last-child { font-size: 9px; font-weight: 900; }

        /* Front Positions - Exact as per your request */
        .epic-front-main { position: absolute; top: 48px; left: 12px; font-size: 12px; font-weight: bold; }
        .main-photo { position: absolute; left: 12px; top: 68px; width: 72px; height: 92px; border: 0.5px solid #000; object-fit: cover; z-index: 5; }
        
        /* SECOND PHOTO & SECOND EPIC (VERTICAL) */
        .ghost-photo { position: absolute; right: 18px; top: 60px; width: 35px; height: 45px; opacity: 0.6; filter: grayscale(20%); z-index: 4; }
        .vertical-epic { position: absolute; right: 8px; top: 60px; font-size: 6px; writing-mode: vertical-rl; font-weight: bold; color: #333; }

        .v-details { position: absolute; left: 95px; top: 65px; font-size: 9px; line-height: 1.3; font-weight: 600; }
        .v-details b { font-size: 9.5px; font-weight: 800; }

        .v-footer-text { position: absolute; bottom: 0; width: 100%; height: 20px; border-top: 1px solid #000; background: #fff; display: flex; align-items: center; justify-content: center; font-size: 8.5px; font-weight: bold; }

        /* Back Design */
        .v-back-addr { padding: 8px 12px; font-size: 8.5px; line-height: 1.2; font-weight: 600; }
        .qr-area { position: absolute; left: 12px; top: 70px; width: 85px; height: 85px; border: 0.5px solid #ccc; background: #fff; }
        .epic-back-bottom { position: absolute; left: 15px; bottom: 30px; font-size: 11px; font-weight: bold; }
        
        .officer-box { position: absolute; right: 12px; bottom: 32px; text-align: center; width: 160px; }
        .officer-box b { font-size: 8.5px; display: block; line-height: 1; }
        .officer-box span { font-size: 8px; display: block; }
        .dl-date-line { font-size: 8px; font-weight: bold; margin-top: 3px; display: block; }

        .v-footer-back { position: absolute; bottom: 0; width: 100%; height: 22px; border-top: 1.5px solid #b22222; background: #fff; display: flex; align-items: center; justify-content: space-between; padding: 0 10px; box-sizing: border-box; font-size: 8.5px; font-weight: bold; }

        .btn-gen { background: #1a237e; color: #fff; border: none; padding: 15px; border-radius: 4px; cursor: pointer; width: 100%; font-weight: bold; font-size: 16px; margin-top: 10px; }
        .btn-dl { background: #2e7d32; color: #fff; border: none; padding: 12px 40px; border-radius: 4px; cursor: pointer; display: none; margin-top: 20px; font-weight: bold; }
    </style>
</head>
<body>

<div class="form-container">
    <h3 style="text-align: center; margin-top: 0; color: #1a237e;">New e-EPIC Card Generator (Double Photo & Double EPIC)</h3>
    <form id="voterForm">
        <div class="row">
            <div class="form-group"><label>EPIC Number</label><input type="text" id="epic_no" placeholder="IWG2327435"></div>
            <div class="form-group"><label>Name (Hindi)</label><input type="text" id="name_hi"></div>
            <div class="form-group"><label>Name (English)</label><input type="text" id="name_en"></div>
        </div>
        <div class="row">
            <div class="form-group"><label>Father/Husband Name (Hindi)</label><input type="text" id="fh_hi"></div>
            <div class="form-group"><label>Father/Husband Name (English)</label><input type="text" id="fh_en"></div>
            <div class="form-group"><label>DOB (DD/MM/YYYY)</label><input type="text" id="dob" maxlength="10"></div>
        </div>
        <div class="row">
            <div class="form-group"><label>Gender</label><input type="text" id="gender" placeholder="Female / महिला"></div>
            <div class="form-group"><label>Assembly (Hindi)</label><input type="text" id="ac_hi"></div>
            <div class="form-group"><label>Assembly (English)</label><input type="text" id="ac_en"></div>
        </div>
        <div class="row">
            <div class="form-group" style="grid-column: span 3;"><label>Full Address (Hindi & English)</label><input type="text" id="addr_full"></div>
        </div>
        <div class="row">
            <div class="form-group"><label>Manual Download Date</label><input type="text" id="manual_dl" placeholder="DD-MM-YYYY"></div>
            <div class="form-group" style="grid-column: span 2;"><label>Upload Photo</label><input type="file" onchange="previewImg(this)"></div>
        </div>
        <button type="button" class="btn-gen" onclick="generateCard()">Create Final Card</button>
    </form>
</div>

<div id="print-area">
    <div id="capture-zone" style="display: flex; gap: 20px; background: #fff; padding: 15px; border: 1px solid #ccc;">
        <div class="voter-box">
            <div class="v-header">
                <img src="https://upload.wikimedia.org/wikipedia/commons/e/e1/State_Emblem_of_India.svg">
                <div class="v-header-text"><div>भारत निर्वाचन आयोग</div><div>ELECTION COMMISSION OF INDIA</div></div>
                <img src="https://upload.wikimedia.org/wikipedia/commons/0/03/Election_Commission_of_India_logo.png">
            </div>
            
            <div class="epic-front-main" id="f_epic_1"></div>
            <img id="f_photo_main" class="main-photo">
            
            <img id="f_photo_ghost" class="ghost-photo">
            <div class="vertical-epic" id="f_epic_2"></div>

            <div class="v-details">
                नाम : <b id="f_name_hi"></b><br>
                Name : <b id="f_name_en"></b><br>
                पिता का नाम : <span id="f_fh_hi"></span><br>
                Father Name : <span id="f_fh_en"></span><br>
                सेक्स / Gender : / <span id="f_gen"></span><br>
                जन्मतिथि/आयु : <br>
                Date of Birth / Age : <span id="f_dob"></span>
            </div>
            <div class="v-footer-text">e-Electors Photo Identity Card - ई - मतदाता पहचान पत्र</div>
        </div>

        <div class="voter-box">
            <div class="v-back-addr">
                <b>पता :</b> <span id="b_addr"></span>
            </div>
            <div id="qrcode" class="qr-area"></div>
            <div class="epic-back-bottom" id="b_epic"></div>

            <div class="officer-box">
                <img src="https://upload.wikimedia.org/wikipedia/commons/a/af/Signature_of_H._V._Kamath.svg" style="height:16px; margin-bottom:2px;">
                <b id="b_ero_hi"></b>
                <span id="b_ero_en"></span>
                <span class="dl-date-line">Download Date -: <span id="b_dl_date"></span></span>
            </div>
            <div class="v-footer-back">
                <span><i class="fa fa-phone"></i> 1950</span>
                <span>https://ceobihar.nic.in/</span>
            </div>
        </div>
    </div>
    <button type="button" id="dl-btn" class="btn-dl" onclick="downloadCard()">Download PNG Card</button>
</div>

<script>
    // DOB formatting & 10 digit lock
    document.getElementById('dob').addEventListener('input', function (e) {
        let v = e.target.value.replace(/\D/g, '').slice(0, 8);
        if (v.length >= 5) v = v.slice(0, 2) + '/' + v.slice(2, 4) + '/' + v.slice(4);
        else if (v.length >= 3) v = v.slice(0, 2) + '/' + v.slice(2);
        e.target.value = v;
    });

    function previewImg(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function(e) { 
                document.getElementById('f_photo_main').src = e.target.result; 
                document.getElementById('f_photo_ghost').src = e.target.result; 
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    function generateCard() {
        let epic = document.getElementById('epic_no').value.toUpperCase();
        let mDate = document.getElementById('manual_dl').value;
        if(!mDate) {
            let t = new Date();
            mDate = t.getDate().toString().padStart(2, '0') + '-' + (t.getMonth()+1).toString().padStart(2, '0') + '-' + t.getFullYear();
        }

        // Mapping Data
        document.getElementById('f_epic_1').innerText = epic;
        document.getElementById('f_epic_2').innerText = epic;
        document.getElementById('b_epic').innerText = epic;
        
        document.getElementById('f_name_hi').innerText = document.getElementById('name_hi').value;
        document.getElementById('f_name_en').innerText = document.getElementById('name_en').value.toUpperCase();
        document.getElementById('f_fh_hi').innerText = document.getElementById('fh_hi').value;
        document.getElementById('f_fh_en').innerText = document.getElementById('fh_en').value.toUpperCase();
        document.getElementById('f_dob').innerText = document.getElementById('dob').value;
        document.getElementById('f_gen').innerText = document.getElementById('gender').value;
        
        document.getElementById('b_addr').innerText = document.getElementById('addr_full').value;
        document.getElementById('b_dl_date').innerText = mDate;
        document.getElementById('b_ero_hi').innerText = "निर्वाचक निबंधन पदाधिकारी, " + document.getElementById('ac_hi').value;
        document.getElementById('b_ero_en').innerText = "Electoral Registration Officer, " + document.getElementById('ac_en').value;

        // QR Code
        document.getElementById('qrcode').innerHTML = "";
        new QRCode(document.getElementById("qrcode"), { text: epic, width: 85, height: 85 });

        document.getElementById('print-area').style.display = 'flex';
        document.getElementById('dl-btn').style.display = 'inline-block';
    }

    function downloadCard() {
        html2canvas(document.getElementById('capture-zone'), { scale: 3 }).then(canvas => {
            let link = document.createElement('a');
            link.download = 'Final_Voter_Card.png';
            link.href = canvas.toDataURL();
            link.click();
        });
    }
</script>
</body>
    </html>
    
