<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>e-EPIC Voter Card Generator - Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { --voter-bg: #fdfcf0; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #eef2f7; padding: 20px; }
        .form-container { background: #fff; max-width: 950px; margin: 0 auto; padding: 20px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 15px; }
        .form-group { display: flex; flex-direction: column; }
        label { font-size: 12px; font-weight: bold; margin-bottom: 5px; }
        input, select { padding: 10px; border: 1px solid #ccc; border-radius: 8px; font-size: 13px; }

        #print-area { display: none; margin-top: 40px; flex-direction: column; align-items: center; gap: 20px; }
        
        .voter-box { width: 325px; height: 205px; background: var(--voter-bg); border: 0.8px solid #999; position: relative; overflow: hidden; border-radius: 4px; background-image: url('https://www.transparenttextures.com/patterns/cubes.png'); }
        
        .v-header { display: flex; align-items: center; justify-content: space-between; padding: 5px 10px; border-bottom: 1.5px solid #000; background: white; }
        .v-header img.emblem { height: 30px; }
        .v-header img.logo { height: 30px; }
        .v-header-text { text-align: center; flex-grow: 1; }
        .v-header-text div:first-child { font-size: 11px; font-weight: bold; }
        .v-header-text div:last-child { font-size: 9px; font-weight: bold; }

        .epic-front { position: absolute; top: 60px; left: 10px; font-size: 11px; font-weight: bold; z-index: 5; }
        .main-photo { position: absolute; left: 10px; top: 80px; width: 75px; height: 95px; border: 0.5px solid #000; object-fit: cover; }
        .small-photo { position: absolute; right: 15px; top: 65px; width: 35px; height: 45px; opacity: 0.7; filter: grayscale(50%); }
        .small-epic { position: absolute; right: 8px; top: 65px; font-size: 6px; writing-mode: vertical-rl; color: #555; }

        .v-details { position: absolute; left: 95px; top: 75px; font-size: 9px; line-height: 1.4; }
        .v-details b { font-size: 9.5px; }

        .v-footer-front { position: absolute; bottom: 0; width: 100%; height: 22px; border-top: 1px solid #000; background: #fff; display: flex; align-items: center; justify-content: center; font-size: 9px; font-weight: bold; }

        .v-back-addr { padding: 8px 10px; font-size: 8.5px; line-height: 1.2; text-align: left; }
        .qr-area { position: absolute; left: 10px; top: 75px; width: 85px; height: 85px; background: white; padding: 2px; }
        .back-epic-center { position: absolute; left: 15px; top: 165px; font-size: 11px; font-weight: bold; }
        
        .officer-area { position: absolute; right: 15px; top: 135px; text-align: center; width: 150px; }
        .officer-area b { font-size: 9px; display: block; }
        .officer-area span { font-size: 8.5px; }
        .download-date-label { font-size: 8px; margin-top: 1px; display: block; }

        .v-footer-back { position: absolute; bottom: 0; width: 100%; height: 22px; border-top: 1px solid #b22222; background: #fff; display: flex; align-items: center; justify-content: space-between; padding: 0 10px; box-sizing: border-box; font-size: 9px; }

        .btn-gen { background: #1a237e; color: white; border: none; padding: 15px; border-radius: 30px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 10px; }
        .btn-download { background: #27ae60; color: white; border: none; padding: 12px 40px; border-radius: 8px; cursor: pointer; font-weight: bold; display: none; margin-top: 20px; }
    </style>
</head>
<body>

<div class="form-container">
    <h2 style="text-align: center; color: #1a237e;">Voter Card Generator (Custom Date Version)</h2>
    <form id="voterForm">
        <div class="row">
            <div class="form-group"><label>EPIC Number</label><input type="text" id="epic_no" placeholder="IWG2327435"></div>
            <div class="form-group"><label>Hindi Name</label><input type="text" id="name_hi"></div>
            <div class="form-group"><label>English Name</label><input type="text" id="name_en"></div>
        </div>
        <div class="row">
            <div class="form-group"><label>Hindi Father Name</label><input type="text" id="fname_hi"></div>
            <div class="form-group"><label>English Father Name</label><input type="text" id="fname_en"></div>
            <div class="form-group"><label>Date of Birth (dd/mm/yyyy)</label><input type="text" id="dob" maxlength="10" placeholder="DD/MM/YYYY"></div>
        </div>
        <div class="row">
            <div class="form-group"><label>Gender</label><select id="gender"><option value="Male">Male</option><option value="Female">Female</option></select></div>
            <div class="form-group"><label>Manual Download Date</label><input type="text" id="manual_date" maxlength="10" placeholder="DD-MM-YYYY (Blank for Today)"></div>
            <div class="form-group"><label>Photo</label><input type="file" onchange="loadPhoto(this)"></div>
        </div>
        <div class="row">
            <div class="form-group" style="grid-column: span 3;"><label>Hindi Address</label><input type="text" id="addr_hi"></div>
        </div>
        <div class="row">
            <div class="form-group" style="grid-column: span 3;"><label>English Address</label><input type="text" id="addr_en"></div>
        </div>
        <div class="row">
            <div class="form-group" style="grid-column: span 3;"><label>Assembly Constituency</label><input type="text" id="ero_office" placeholder="192-Sandesh"></div>
        </div>
        <button type="button" class="btn-gen" onclick="generateVoter()">Generate Card</button>
    </form>
</div>

<div id="print-area">
    <div id="capture-box" style="display: flex; gap: 20px; background: white; padding: 15px;">
        <div class="voter-box">
            <div class="v-header">
                <img src="https://upload.wikimedia.org/wikipedia/commons/e/e1/State_Emblem_of_India.svg" class="emblem">
                <div class="v-header-text"><div>भारत निर्वाचन आयोग</div><div>ELECTION COMMISSION OF INDIA</div></div>
                <img src="https://upload.wikimedia.org/wikipedia/commons/0/03/Election_Commission_of_India_logo.png" class="logo">
            </div>
            <div class="epic-front" id="f_epic"></div>
            <img id="v_photo" class="main-photo">
            <img id="v_photo_small" class="small-photo">
            <div class="small-epic" id="f_epic_small"></div>
            <div class="v-details">
                नाम : <b id="f_name_hi"></b><br>Name: <b id="f_name_en"></b><br>
                पिता का नाम : <span id="f_fname_hi"></span><br>Father Name: <span id="f_fname_en"></span><br>
                सेक्स / Gender: / <span id="f_gen"></span><br>
                जन्मतिथि/आयु : <br>Date of Birth / Age: <span id="f_dob"></span>
            </div>
            <div class="v-footer-front">ई - मतदाता पहचान पत्र</div>
        </div>

        <div class="voter-box">
            <div class="v-back-addr">
                <b>पता :</b> <span id="b_addr_hi"></span><br><b>Address:</b> <br><span id="b_addr_en"></span>
            </div>
            <div id="qrcode" class="qr-area"></div>
            <div class="back-epic-center" id="b_epic"></div>
            <div class="officer-area">
                <img src="https://upload.wikimedia.org/wikipedia/commons/a/af/Signature_of_H._V._Kamath.svg" style="height:20px;">
                <b id="b_ero_hi"></b><span id="b_ero_en"></span>
                <span class="download-date-label">Download Date -: <span id="disp_date"></span></span>
            </div>
            <div class="v-footer-back"><span>1950</span><span>https://ceobihar.nic.in/</span></div>
        </div>
    </div>
    <button type="button" id="dl-btn" class="btn-download" onclick="downloadVoter()">Download PNG</button>
</div>

<script>
    // DOB Auto-slash and limit to 10 chars
    document.getElementById('dob').addEventListener('input', function (e) {
        let v = e.target.value.replace(/\D/g, '').slice(0, 8);
        if (v.length >= 5) v = v.slice(0, 2) + '/' + v.slice(2, 4) + '/' + v.slice(4);
        else if (v.length >= 3) v = v.slice(0, 2) + '/' + v.slice(2);
        e.target.value = v;
    });

    // Manual Date Auto-dash
    document.getElementById('manual_date').addEventListener('input', function (e) {
        let v = e.target.value.replace(/\D/g, '').slice(0, 8);
        if (v.length >= 5) v = v.slice(0, 2) + '-' + v.slice(2, 4) + '-' + v.slice(4);
        else if (v.length >= 3) v = v.slice(0, 2) + '-' + v.slice(2);
        e.target.value = v;
    });

    function loadPhoto(input) {
        if (input.files && input.files[0]) {
            var r = new FileReader();
            r.onload = function(e) { 
                document.getElementById('v_photo').src = e.target.result; 
                document.getElementById('v_photo_small').src = e.target.result; 
            };
            r.readAsDataURL(input.files[0]);
        }
    }

    function generateVoter() {
        let epic = document.getElementById('epic_no').value.toUpperCase();
        let mDate = document.getElementById('manual_date').value;
        
        // Date Logic
        if(!mDate) {
            let t = new Date();
            mDate = t.getDate().toString().padStart(2, '0') + '-' + (t.getMonth()+1).toString().padStart(2, '0') + '-' + t.getFullYear();
        }

        document.getElementById('f_epic').innerText = epic;
        document.getElementById('b_epic').innerText = epic;
        document.getElementById('f_epic_small').innerText = epic;
        document.getElementById('f_name_hi').innerText = document.getElementById('name_hi').value;
        document.getElementById('f_name_en').innerText = document.getElementById('name_en').value.toUpperCase();
        document.getElementById('f_fname_hi').innerText = document.getElementById('fname_hi').value;
        document.getElementById('f_fname_en').innerText = document.getElementById('fname_en').value.toUpperCase();
        document.getElementById('f_gen').innerText = document.getElementById('gender').value;
        document.getElementById('f_dob').innerText = document.getElementById('dob').value;
        document.getElementById('b_addr_hi').innerText = document.getElementById('addr_hi').value;
        document.getElementById('b_addr_en').innerText = document.getElementById('addr_en').value;
        document.getElementById('disp_date').innerText = mDate;

        let ero = document.getElementById('ero_office').value;
        document.getElementById('b_ero_hi').innerText = "निर्वाचक निबंधन पदाधिकारी, " + ero;
        document.getElementById('b_ero_en').innerText = "Electoral Registration Officer, " + ero;

        document.getElementById('qrcode').innerHTML = "";
        new QRCode(document.getElementById("qrcode"), { text: epic, width: 85, height: 85 });

        document.getElementById('print-area').style.display = 'flex';
        document.getElementById('dl-btn').style.display = 'block';
    }

    function downloadVoter() {
        html2canvas(document.getElementById('capture-box'), { scale: 3 }).then(canvas => {
            let link = document.createElement('a');
            link.download = 'Voter_Card.png';
            link.href = canvas.toDataURL();
            link.click();
        });
    }
</script>
</body>
                                                                                                 </html>
                                                                                                 
